#!/usr/bin/env node

const { execSync } = require("child_process");

const runCommand = (command) => {
  try {
    execSync(command, { stdio: "inherit" });
  } catch (error) {
    console.log(error);
    return false;
  }

  return true;
};

const projectName = process.argv[2];

if (!projectName) {
  console.log("Please specify the project name");
  console.log("For example: express-typescript-arc my-app");
  return;
}

const command = `git clone https://github.com/mubashiralikalhoro/express-typescript-arc.git ${projectName}`;
console.log("Cloning express-typescript-arc... ");
let ok = runCommand(command);
if (!ok) {
  console.log("Failed to clone express-typescript-arc");
  return;
}
console.log("Installing dependencies...");

const devDependencies = ["@types/express", "@types/node", "nodemon", "typescript", "concurrently"];

const command2 = `cd ${projectName} && npm install express && npm install --save-dev ${devDependencies.join(" ")}`;
ok = runCommand(command2);

if (!ok) {
  console.log("Failed to install dependencies");
  return;
}

console.log("App created successfully!");
console.log("Thank you for using express-typescript-arc!");
console.log("Created by Mubashir Ali Kalhoro");
console.log(`Run 'cd ${projectName} && npm run dev' to start the development server`);
